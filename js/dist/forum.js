(()=>{var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var o in r)t.o(r,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:r[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["common/app"];t.n(e)().initializers.add("huseyinfiliz-sort-changer-common",function(){console.log("[huseyinfiliz/sort-changer] Hello, forum and admin!")});const r=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/app"];var n=t.n(o);const a=flarum.core.compat["forum/components/IndexPage"];var s=t.n(a);const i=flarum.core.compat["forum/states/DiscussionListState"];var u=t.n(i);n().initializers.add("huseyinfiliz-sort-changer",function(){var t={latest:"-lastPostedAt",oldest:"createdAt",newest:"-createdAt",top:"-commentCount"},e={latest:0,top:1,newest:2,oldest:3};function o(){var t=n().current.get("routeName");return"index"===t||"default"===t}function a(){return n().forum.attribute("sortChangerDefaultSort")}function i(t){var r;if(o()&&(t||(t=m.route.param("sort")||a()),t&&"latest"!==t)){var n=e[t];if(void 0!==n){var s=document.querySelector(".IndexPage-toolbar .Dropdown-toggle .Button-label"),i=document.querySelector(".IndexPage-toolbar .Dropdown-menu");if(s&&i){var u=i.querySelectorAll("li"),c=null==(r=u[n])?void 0:r.querySelector("button");if(c){var l=c.querySelector(".Button-label");l&&(s.textContent=l.textContent)}u.forEach(function(t,e){var r=t.querySelector("button"),o=t.querySelector(".Button-icon");e===n?(r&&r.setAttribute("active",""),o&&o.classList.add("fas","fa-check")):(r&&r.removeAttribute("active"),o&&o.classList.remove("fas","fa-check"))})}}}}function c(t){var e=document.querySelector(".IndexPage-results");e&&(e.classList.toggle("DiscussionList--loading-sort",!t),e.classList.toggle("DiscussionList--ready",t))}(0,r.override)(u().prototype,"sortMap",function(t){var e=t();return e.latest="-lastPostedAt",e}),(0,r.override)(u().prototype,"sortValue",function(t){if(!o())return t();var e=this.params.sort;if(e)return e;var r=a();return r&&"latest"!==r?r:t()}),(0,r.override)(u().prototype,"requestParams",function(e){var r=e();if(!o())return r;var n=a(),s=this.params.sort;return s&&t[s]?r.sort=t[s]:n&&"latest"!==n&&(r.sort=t[n]),r});var l=!0;function f(){var t=n().current.get("routeName");return("index"===t||"default"===t)&&!(m.route.param("tags")||m.route.param("q")||m.route.param("filter"))}document.addEventListener("click",function(t){var e=t.target.closest("a");if(e){var r=e.getAttribute("href"),o=n().forum.attribute("baseUrl"),s=a();("/"===r||r===o||r===o+"/"||e.closest(".Header-logo"))&&s&&"latest"!==s&&requestAnimationFrame(function(){return i(s)})}},!0),(0,r.extend)(s().prototype,"oninit",function(){if(f()){var t=a();if(!m.route.param("sort")&&t&&"latest"!==t){var e=new URL(window.location.href);e.searchParams.set("sort",t),window.history.replaceState(null,"",e.toString()),n().discussions&&(n().discussions.params.sort=t,l&&(l=!1,requestAnimationFrame(function(){return c(!1)}),n().discussions.clear(),n().discussions.refresh().then(function(){c(!0),m.redraw()})))}}}),(0,r.extend)(s().prototype,"oncreate",function(){if(f()){var t=a();!m.route.param("sort")&&t&&"latest"!==t&&requestAnimationFrame(function(){return i(t)}),setTimeout(i,100)}}),(0,r.extend)(s().prototype,"onupdate",function(){f()&&requestAnimationFrame(i)}),document.addEventListener("click",function(t){if(o()){var e=t.target.closest(".Dropdown-menu button");if(e){var r=e.closest(".Dropdown-menu");if(r){var s=r.querySelectorAll("button");if(0===Array.from(s).indexOf(e)){var i=a();if(i&&"latest"!==i)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),m.route.set(n().route("index",{sort:"latest"})),!1}}}}},!0)})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map