{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@huseyinfiliz/sort-changer/webpack/bootstrap","webpack://@huseyinfiliz/sort-changer/webpack/runtime/compat get default export","webpack://@huseyinfiliz/sort-changer/webpack/runtime/define property getters","webpack://@huseyinfiliz/sort-changer/webpack/runtime/hasOwnProperty shorthand","webpack://@huseyinfiliz/sort-changer/external root \"flarum.core.compat['common/app']\"","webpack://@huseyinfiliz/sort-changer/./src/common/index.ts","webpack://@huseyinfiliz/sort-changer/external root \"flarum.core.compat['common/extend']\"","webpack://@huseyinfiliz/sort-changer/external root \"flarum.core.compat['forum/app']\"","webpack://@huseyinfiliz/sort-changer/external root \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@huseyinfiliz/sort-changer/external root \"flarum.core.compat['forum/states/DiscussionListState']\"","webpack://@huseyinfiliz/sort-changer/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/app'];","import app from 'flarum/common/app';\n\napp.initializers.add('huseyinfiliz-sort-changer-common', () => {\n  console.log('[huseyinfiliz/sort-changer] Hello, forum and admin!');\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/IndexPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/states/DiscussionListState'];","import { extend, override } from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport DiscussionListState from 'flarum/forum/states/DiscussionListState';\n\napp.initializers.add('huseyinfiliz-sort-changer', () => {\n  const apiSortMap = {\n    'latest': '-lastPostedAt',\n    'oldest': 'createdAt',\n    'newest': '-createdAt',\n    'top': '-commentCount'\n  };\n  \n  const sortIndexMap = { 'latest': 0, 'top': 1, 'newest': 2, 'oldest': 3 };\n  \n  function isIndexPage() {\n    const routeName = app.current.get('routeName');\n    return routeName === 'index' || routeName === 'default';\n  }\n  \n  function getDefaultSort() {\n    return app.forum.attribute('sortChangerDefaultSort');\n  }\n  \n  // Sort map'i genişlet - latest'i ekle\n  override(DiscussionListState.prototype, 'sortMap', function(original) {\n    const map = original();\n    map['latest'] = '-lastPostedAt';\n    return map;\n  });\n  \n  // Dropdown'da doğru değeri göster\n  override(DiscussionListState.prototype, 'sortValue', function(original) {\n    if (!isIndexPage()) return original();\n    \n    const currentSort = this.params.sort;\n    if (currentSort) return currentSort;\n    \n    const defaultSort = getDefaultSort();\n    if (defaultSort && defaultSort !== 'latest') return defaultSort;\n    \n    return original();\n  });\n  \n  // API çağrısında sort parametresi\n  override(DiscussionListState.prototype, 'requestParams', function(original) {\n    const params = original();\n    if (!isIndexPage()) return params;\n    \n    const defaultSort = getDefaultSort();\n    const currentSort = this.params.sort;\n    \n    if (currentSort && apiSortMap[currentSort]) {\n      params.sort = apiSortMap[currentSort];\n    } else if (defaultSort && defaultSort !== 'latest') {\n      params.sort = apiSortMap[defaultSort];\n    }\n    \n    return params;\n  });\n  \n  // Dropdown'u DOM ile güncelle\n  function updateDropdown(activeSort) {\n    if (!isIndexPage()) return;\n    \n    if (!activeSort) {\n      const currentSort = m.route.param('sort');\n      activeSort = currentSort || getDefaultSort();\n    }\n    \n    if (!activeSort || activeSort === 'latest') return;\n    \n    const targetIndex = sortIndexMap[activeSort];\n    if (targetIndex === undefined) return;\n    \n    const dropdownToggle = document.querySelector('.IndexPage-toolbar .Dropdown-toggle .Button-label');\n    const dropdownMenu = document.querySelector('.IndexPage-toolbar .Dropdown-menu');\n    \n    if (!dropdownToggle || !dropdownMenu) return;\n    \n    const listItems = dropdownMenu.querySelectorAll('li');\n    const targetButton = listItems[targetIndex]?.querySelector('button');\n    \n    if (targetButton) {\n      const targetLabel = targetButton.querySelector('.Button-label');\n      if (targetLabel) {\n        dropdownToggle.textContent = targetLabel.textContent;\n      }\n    }\n    \n    listItems.forEach((li, index) => {\n      const button = li.querySelector('button');\n      const icon = li.querySelector('.Button-icon');\n      \n      if (index === targetIndex) {\n        if (button) button.setAttribute('active', '');\n        if (icon) icon.classList.add('fas', 'fa-check');\n      } else {\n        if (button) button.removeAttribute('active');\n        if (icon) icon.classList.remove('fas', 'fa-check');\n      }\n    });\n  }\n  \n  // Liste görünürlüğü\n  function setListVisibility(ready) {\n    const container = document.querySelector('.IndexPage-results');\n    if (!container) return;\n    \n    container.classList.toggle('DiscussionList--loading-sort', !ready);\n    container.classList.toggle('DiscussionList--ready', ready);\n  }\n  \n  let initialLoad = true;\n  \n  // Anasayfa linklerine tıklandığında dropdown'u güncelle\n  document.addEventListener('click', (e) => {\n    const link = e.target.closest('a');\n    if (!link) return;\n    \n    const href = link.getAttribute('href');\n    const baseUrl = app.forum.attribute('baseUrl');\n    const defaultSort = getDefaultSort();\n    \n    const isHomeLink = href === '/' || \n                       href === baseUrl || \n                       href === baseUrl + '/' ||\n                       link.closest('.Header-logo');\n    \n    if (isHomeLink && defaultSort && defaultSort !== 'latest') {\n      requestAnimationFrame(() => updateDropdown(defaultSort));\n    }\n  }, true);\n  \n  // Index sayfası kontrolü\n  function shouldHandle() {\n    const routeName = app.current.get('routeName');\n    if (routeName !== 'index' && routeName !== 'default') return false;\n    if (m.route.param('tags') || m.route.param('q') || m.route.param('filter')) return false;\n    return true;\n  }\n  \n  // Parametresiz gelince varsayılana yönlendir\n  extend(IndexPage.prototype, 'oninit', function() {\n    if (!shouldHandle()) return;\n    \n    const defaultSort = getDefaultSort();\n    const currentSort = m.route.param('sort');\n    \n    if (!currentSort && defaultSort && defaultSort !== 'latest') {\n      const url = new URL(window.location.href);\n      url.searchParams.set('sort', defaultSort);\n      window.history.replaceState(null, '', url.toString());\n      \n      if (app.discussions) {\n        app.discussions.params.sort = defaultSort;\n        \n        if (initialLoad) {\n          initialLoad = false;\n          requestAnimationFrame(() => setListVisibility(false));\n          \n          app.discussions.clear();\n          app.discussions.refresh().then(() => {\n            setListVisibility(true);\n            m.redraw();\n          });\n        }\n      }\n    }\n  });\n  \n  // Dropdown güncelleme\n  extend(IndexPage.prototype, 'oncreate', function() {\n    if (!shouldHandle()) return;\n    \n    const defaultSort = getDefaultSort();\n    const currentSort = m.route.param('sort');\n    \n    if (!currentSort && defaultSort && defaultSort !== 'latest') {\n      requestAnimationFrame(() => updateDropdown(defaultSort));\n    }\n    \n    setTimeout(updateDropdown, 100);\n  });\n  \n  extend(IndexPage.prototype, 'onupdate', function() {\n    if (!shouldHandle()) return;\n    requestAnimationFrame(updateDropdown);\n  });\n  \n  // Latest butonuna tıklandığında ?sort=latest ekle\n  document.addEventListener('click', (e) => {\n    if (!isIndexPage()) return;\n    \n    const dropdownButton = e.target.closest('.Dropdown-menu button');\n    if (!dropdownButton) return;\n    \n    const dropdownMenu = dropdownButton.closest('.Dropdown-menu');\n    if (!dropdownMenu) return;\n    \n    const allButtons = dropdownMenu.querySelectorAll('button');\n    const buttonIndex = Array.from(allButtons).indexOf(dropdownButton);\n    \n    if (buttonIndex === 0) {\n      const defaultSort = getDefaultSort();\n      \n      if (defaultSort && defaultSort !== 'latest') {\n        e.preventDefault();\n        e.stopPropagation();\n        e.stopImmediatePropagation();\n        \n        m.route.set(app.route('index', { sort: 'latest' }));\n        return false;\n      }\n    }\n  }, true);\n});"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","app","add","console","log","apiSortMap","sortIndexMap","isIndexPage","routeName","getDefaultSort","attribute","updateDropdown","activeSort","_listItems$targetInde","m","route","param","targetIndex","undefined","dropdownToggle","document","querySelector","dropdownMenu","listItems","querySelectorAll","targetButton","targetLabel","textContent","forEach","li","index","button","icon","setAttribute","classList","removeAttribute","remove","setListVisibility","ready","container","toggle","override","DiscussionListState","original","map","currentSort","this","params","sort","defaultSort","initialLoad","shouldHandle","addEventListener","e","link","target","closest","href","getAttribute","baseUrl","requestAnimationFrame","extend","IndexPage","url","URL","window","location","searchParams","set","history","replaceState","toString","clear","refresh","then","redraw","setTimeout","dropdownButton","allButtons","Array","from","indexOf","preventDefault","stopPropagation","stopImmediatePropagation"],"sourceRoot":""}